#!/bin/bash

tmux-cwd() {
#  IP=$(echo $PWD | grep -oE '([0-9]+\.){3}[0-9]+')
  #tmux command-prompt -I $PWD -p "New session dir:" "attach -c %1"
  tmux command-prompt -I "$PWD" -p "New session dir:" "attach-session -c %1"
}

otools() {
  thunar; code .;
}

# Start and source a Python VirtualEnv
# venv - loads Python 3 by default
# venv 3 - loads Python 3
# venv 2/2.7 - loads Python 2.7
venv() {
  # Source the venv if it already exists
  if [[ -f "./venv/bin/activate" ]]; then
      source venv/bin/activate
      return
  fi

  PYVER=3

  # Set version
  if [[ -n "$1" ]]; then
    PYVER="$1"
  fi

  if [[ "$PYVER" == "2" ]]; then
    PYVER="2.7"
  fi

  virtualenv -p "/usr/bin/python$PYVER" venv
  source venv/bin/activate
}

PEASS_DOWNLOAD_URL="https://github.com/carlospolop/PEASS-ng/releases/latest/download"
PEASS_BINARIES="/opt/packages/peass_binaries"

upgrade_winpeas() {
  mkdir -p "$PEASS_BINARIES/winpeas"
  wget "$PEASS_DOWNLOAD_URL/winPEAS.bat" -O "$PEASS_BINARIES/winpeas/winPEAS.bat"
  wget "$PEASS_DOWNLOAD_URL/winPEASany_ofs.exe" -O "$PEASS_BINARIES/winpeas/winPEASany.exe"
  wget "$PEASS_DOWNLOAD_URL/winPEASx64_ofs.exe" -O "$PEASS_BINARIES/winpeas/winPEASx64.exe"
  wget "$PEASS_DOWNLOAD_URL/winPEASx86_ofs.exe" -O "$PEASS_BINARIES/winpeas/winPEASx86.exe"

  ln -sf "$PEASS_BINARIES/winpeas/winPEAS.bat" /opt/enum/windows/winpeas.bat
  ln -sf "$PEASS_BINARIES/winpeas/winPEASany.exe" /opt/enum/windows/winpeas.exe

  find "$PEASS_BINARIES/winpeas" -type f -exec chmod +x {} \;
}

upgrade_linpeas() {
  mkdir -p "$PEASS_BINARIES/linpeas"
  wget "$PEASS_DOWNLOAD_URL/linpeas.sh" -O "$PEASS_BINARIES/linpeas/linpeas.sh"
  wget "$PEASS_DOWNLOAD_URL/linpeas_linux_amd64" -O "$PEASS_BINARIES/linpeas/linpeas.elf"

  ln -sf "$PEASS_BINARIES/linpeas/linpeas.sh" /opt/enum/linux/linpeas.sh
  ln -sf "$PEASS_BINARIES/linpeas/linpeas.elf" /opt/enum/linux/linpeas.elf

  find "$PEASS_BINARIES/linpeas" -type f -exec chmod +x {} \;
}

upgrade_peass() {
  upgrade_linpeas
  upgrade_winpeas
}
